@startuml Finance Calculator - Sequence Diagram

title Flujos de Cálculo (Interés Compuesto y ROI)

actor Usuario
participant "UI\n(index.html)" as UI
participant "Calculations\n(calculations.js)" as Calc
participant "ROI Logic\n(roi-calculator.js)" as ROI
participant "History\n(history.js)" as History
database "LocalStorage\n(Browser)" as Storage

== Fase 1: Ingreso de Datos ==

Usuario -> UI: Ingresa datos\n(Principal, Rate, Time, etc.)
activate UI

UI -> UI: Valida campos no vacíos
note right: Verifica que todos\nlos inputs tengan valores

== Fase 2: Trigger de Cálculo ==

alt Click en "Calcular Interés Compuesto"
    Usuario -> UI: Click Calcular
    UI -> Calc: handleCompoundInterest()
    activate Calc

    == Fase 3: Validación (Compound) ==
    Calc -> Calc: Obtiene valores
    Calc -> Calc: Valida isNaN()
    
    alt Valores inválidos
        Calc -> UI: alert("Error")
    else Valores válidos
        Calc -> Calc: computeCompoundInterest()
        
        Calc -> UI: updateResult()
        UI -> Usuario: Muestra resultado
        
        opt Guardar en Historial
            == Fase 4: Guardar ==
            Usuario -> UI: Click Guardar
            UI -> History: saveCalculationToHistory()
            activate History
            History -> Storage: save()
            History -> UI: Confirmar
            deactivate History
        end
    end
    deactivate Calc

else Click en "Calcular ROI"
    Usuario -> UI: Click Calcular ROI
    UI -> ROI: calculateROI()
    activate ROI
    
    ROI -> ROI: Obtiene valores
    
    alt Valores inválidos
        ROI -> UI: alert("Error")
    else Valores válidos
        ROI -> ROI: calculateROI()
        note right: Calcula ROI Simple\ny Anualizado
        
        ROI -> UI: updateROIUI()
        UI -> Usuario: Muestra % ROI
        
        ROI -> ROI: saveROIHistory()
        ROI -> History: saveCalculationToHistory()
    end
    deactivate ROI
end

note over Usuario, Storage
  **Flujo Completo:**
  1. Usuario ingresa datos
  2. UI valida y captura evento
  3. Calculations/ROI calcula
  4. Resultado se muestra en UI
  5. Usuario guarda en historial
end note

@enduml
